이번 장에서 살펴볼 내용은 트랜잭션과 잠금, 트랜잭션 격리 수준이다.

해당 내용을 가볍게 살펴 보면 다음과 같다.

트랜잭션은 작업의 완전성을 보장해 주는 것으로, 작업시 추가 수정 삭제 조회되는 데이터의 정합성을 위한 기능이다.

잠금은 여러 커넥션이 동시에 동일한 자원 요청 시 순서대로 하나의 커넥션만 접근을 가능하게하는 동시성 제어하기 위한 기능이다.

격리수준은 여러 트랜잭션에서 작업 내용을 어떻게 공유하고 차단할지 정하는 레벨을 뜻한다.



# 5.1 트랜잭션
> 트랜잭션은 논리적 작업의 세트로, 원자성을 보장한다.

- 트랜잭션을 지원하지 않는 MyISAM에서는 쿼리중 오류가 발생해도 전 상태로 복구할 수 없다. (Partial update 발생)
- 때문에 오류 발생 시 수동으로 부분 업데이트된 데이터를 삭제하는 (원상태로 복구하는) 로직을 담아야 한다.

## 트랜잭션의 범위 설정 주의사항
> 프로그램 코드의 트랜잭션의 범위 설정은 되도록 최소화 하는 것이 좋다.

- 프로그램은 DB와 커넥션을 맺고 트랜잭션을 시작한다.
- 커넥션은 한정적이기 때문에 커넥션의 소유 기간이 길어지면 다른 작업들은 커넥션을 맺지 못하고 대기해야 한다.
- 때문에 프로그램 코드에서 트랜잭션의 범위를 회소화 하여 커넥션 점유 시간을 최소화 해야 한다.

DB서버는 커넥션 1개당 DB 리소스(스레드, 메모리 버퍼, 캐시 공간 등)를 고정적으로 차지하는데,  
프로그램과 커넥션을 오래 맺게 되면 이러한 리소스가 낭비될 뿐더러,

트랜잭션이 유지되면 락도 유지되므로, 다른 트랜잭션과 락 경합과 데드락이 발생할 수 있다.

[TX 범위 최소화를 위한 전략]
1. 읽기만으로 이루어진 쿼리들은 트랜잭션에서 제외한다.
2. 서비스 로직에서 다른 서버와 통신하는 네트워크 작업 로직이 있다면 해당 작업은 트랜잭션에서 제외한다.

메일 전송이나 파일 전송 혹은 원격서버와 통신하는 로직은 오래 걸리기도 하고, 
만약 서버의 오류로 통신할 수 없는 상황이 되면 타임아웃 시 까지 커넥션을 점유한 채 대기해야 한다.


떄문에 되도록 트랜잭션의 범위 설정을 최소화 하는 것이 중요하다.


